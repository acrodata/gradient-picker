<div class="gradient-stops-slider" [class.is-dragging]="isDragging">
  <div class="gradient-stops-slider-bar" (pointerdown)="addStop($event)">
    <div class="gradient-stops-slider-bar-bg" [style.background-image]="gradientColor"></div>
  </div>

  <div #sliderTrack class="gradient-stops-slider-track">
    @for (stop of sliderColorStops; track stop.id) {
      <div
        class="gradient-stops-slider-pointer"
        cdkDrag
        cdkDragLockAxis="x"
        [cdkDragBoundary]="sliderTrack"
        [cdkDragFreeDragPosition]="stop.position"
        (cdkDragMoved)="onDragMove($event, stop, $index)"
        (cdkDragEnded)="onDragEnd($event, stop)"
      >
        <div
          #sliderThumb
          class="gradient-stops-slider-thumb"
          [class.gradient-stops-slider-thumb-active]="stop === selectedStop"
          (pointerdown)="onDragHandleDown($event, stop)"
          (pointerup)="onDragHandleUp($event)"
        >
          <gradient-colorpicker-toggle
            [id]="'gradient-colorpicker-toggle-' + stop.id"
            [for]="gc"
            [color]="stop.color"
            [overlayOrigin]="sliderThumb"
            triggerEvent="dblclick"
            (keydown.backspace)="onStopRemove(stop)"
            (keydown.delete)="onStopRemove(stop)"
            (keydown.arrowup)="moveStop($event, stop, $index, 1)"
            (keydown.arrowright)="moveStop($event, stop, $index, 1)"
            (keydown.arrowdown)="moveStop($event, stop, $index, -1)"
            (keydown.arrowleft)="moveStop($event, stop, $index, -1)"
          />
          <gradient-colorpicker
            #gc
            [(ngModel)]="stop.color"
            (ngModelChange)="onStopColorChange(stop)"
          />
        </div>
      </div>
    }
  </div>
</div>

<div class="gradient-stop-list-wrapper">
  <div class="gradient-stop-list-header">
    <span>Stops</span>
    <gradient-icon-button>
      <button type="button" (click)="addStop()" title="Add stop" aria-label="Add stop">
        <svg viewBox="0 0 24 24">
          <path
            fill="currentColor"
            d="M12 6a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 12 6"
            clip-rule="evenodd"
          />
        </svg>
      </button>
    </gradient-icon-button>
  </div>
  <div class="gradient-stop-list-body">
    <ul class="gradient-stop-list">
      @for (stop of sliderColorStops; track stop.id) {
        <li
          class="gradient-stop-item"
          [class.gradient-stop-item-active]="stop === selectedStop"
          (pointerdown)="onStopItemClick(stop)"
        >
          <gradient-input-field
            class="gradient-stop-item-color"
            cdkOverlayOrigin
            #colorField="cdkOverlayOrigin"
          >
            <gradient-colorpicker-toggle
              [for]="gc"
              [color]="stop.color"
              [overlayOrigin]="colorField"
            />
            <gradient-colorpicker
              #gc
              [(ngModel)]="stop.color"
              (ngModelChange)="onStopColorChange(stop)"
            />
            <input type="text" [(ngModel)]="stop.color" (change)="onStopColorChange(stop)" />
          </gradient-input-field>
          <gradient-input-field class="gradient-stop-item-offset">
            <input
              [id]="'gradient-stop-item-offset-' + stop.id"
              type="number"
              [min]="0"
              [max]="stop.offset.unit === '%' ? 100 : null"
              [(ngModel)]="stop.offset.value"
              (change)="onStopOffsetChange(stop)"
            />
            <select [(ngModel)]="stop.offset.unit" (change)="onStopOffsetChange(stop)">
              <option value="%">%</option>
              <option value="px">px</option>
            </select>
          </gradient-input-field>
          <gradient-icon-button>
            @if (sliderColorStops.length > 1) {
              <button
                type="button"
                (click)="onStopRemove(stop)"
                title="Remove stop"
                aria-label="Remove stop"
              >
                <svg viewBox="0 0 24 24">
                  <path
                    fill="currentColor"
                    d="M6 12a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 6 12"
                  />
                </svg>
              </button>
            }
          </gradient-icon-button>
        </li>
      }
    </ul>
  </div>
</div>
